<template>
  <div ref="cesiumContainer" style="width: 100%; height: 90vh"></div>
</template>

<script setup>
import { ref, onMounted } from "vue";
import * as Cesium from "cesium";
const cesiumContainer = ref(null);
let viewer = null;

onMounted(async () => {
  // 设置访问令牌
  // Cesium.Ion.defaultAccessToken =
  //   "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwZTEwODgwMS1iYTY0LTRhNmYtYWFhMS03MDEzMjlhYWNjOTciLCJpZCI6MzAwMTM5LCJpYXQiOjE3NDY1ODI5MTR9.P4bdCMYyoubNMaQ_-ZkU99mM8Da3o8HIo4A57stHRAg";

  // 初始化Viewer
  viewer = new Cesium.Viewer(cesiumContainer.value, {
    geocoder: false, // 关闭地理编码搜索
    homeButton: false, // 关闭主页按钮
    sceneModePicker: false, // 关闭场景模式选择器
    baseLayerPicker: false, // 关闭底图选择器
    navigationHelpButton: false, // 关闭导航帮助
    animation: false, // 关闭动画控件
    timeline: false, // 关闭时间轴
    fullscreenButton: false, // 关闭全屏按钮
    // selectionIndicator: false,
    // infoBox: false,
    // 开启地形
    terrainProvider: await Cesium.createWorldTerrainAsync({
      requestVertexNormals: true, // 真实光照效果
      requestWaterMask: true, // 真实水面流动效果
    }),
  });

  // -------------------------------
  // 案例1：创建一个虚线和实线重叠的线，大约十个点左右,线条弯曲一些,点位在珠穆朗玛峰
  const positions = [
    [104.171074, 31.732299],
    [104.14768, 31.727105],
    [104.142658, 31.715452],
    [104.136369, 31.712551],
    [104.129151, 31.712434],
    [104.119837, 31.707028],
    [104.114142, 31.710702],
    [104.103147, 31.710304],
    [104.103266, 31.702792],
    [104.094842, 31.693874],
    [104.115151, 31.684605],
    [104.11697, 31.677746],
    [104.115428, 31.673906],
    [104.108269, 31.667843],
    [104.10204, 31.658688],
    [104.098441, 31.648595],
    [104.102732, 31.630609],
    [104.107636, 31.62576],
    [104.118611, 31.618873],
    [104.122962, 31.60969],
    [104.13279, 31.605333],
    [104.129764, 31.598749],
    [104.133462, 31.594484],
    [104.143488, 31.586588],
    [104.145742, 31.579979],
    [104.145822, 31.565777],
    [104.146949, 31.563831],
    [104.158833, 31.559284],
    [104.161107, 31.556119],
    [104.159585, 31.550962],
    [104.152308, 31.541749],
    [104.158121, 31.526509],
    [104.155709, 31.519052],
    [104.162393, 31.516988],
    [104.170599, 31.512368],
    [104.175385, 31.517574],
    [104.181396, 31.520084],
    [104.189069, 31.519497],
    [104.202892, 31.514526],
    [104.208824, 31.505403],
    [104.207697, 31.500477],
    [104.217229, 31.497311],
    [104.216774, 31.493135],
    [104.221559, 31.490602],
    [104.226641, 31.484175],
    [104.232831, 31.47235],
    [104.233048, 31.467494],
    [104.23645, 31.463575],
    [104.255829, 31.459023],
    [104.265202, 31.462238],
    [104.272183, 31.458037],
    [104.285748, 31.436306],
    [104.290297, 31.43356],
    [104.300481, 31.432081],
    [104.310981, 31.427715],
    [104.322134, 31.412597],
    [104.327157, 31.411752],
    [104.324744, 31.40546],
    [104.32686, 31.399308],
    [104.341316, 31.385594],
    [104.347466, 31.381814],
    [104.358105, 31.386346],
    [104.365184, 31.376013],
    [104.375744, 31.373781],
    [104.385117, 31.376858],
    [104.386996, 31.38287],
    [104.394352, 31.379817],
    [104.40157, 31.3797],
    [104.41826, 31.374838],
    [104.425003, 31.369765],
    [104.427633, 31.374157],
    [104.426842, 31.380005],
    [104.432201, 31.381508],
    [104.431529, 31.378103],
    [104.436196, 31.376694],
    [104.450078, 31.381579],
    [104.459312, 31.378972],
    [104.461606, 31.38172],
    [104.479325, 31.38543],
    [104.481381, 31.389328],
    [104.487274, 31.390549],
    [104.488184, 31.394189],
    [104.477624, 31.402407],
    [104.477782, 31.407197],
    [104.484347, 31.410766],
    [104.492673, 31.410766],
    [104.495144, 31.407784],
    [104.501077, 31.410648],
    [104.50519, 31.424429],
    [104.511281, 31.42741],
    [104.505922, 31.432715],
    [104.513594, 31.428302],
    [104.517451, 31.429968],
    [104.516027, 31.434193],
    [104.518004, 31.437526],
    [104.521781, 31.437362],
    [104.52364, 31.442596],
    [104.520259, 31.444121],
    [104.515315, 31.450599],
    [104.506891, 31.454447],
    [104.502679, 31.458249],
    [104.500978, 31.468057],
    [104.50436, 31.469535],
    [104.502125, 31.47343],
    [104.49467, 31.47709],
    [104.490003, 31.484738],
    [104.490221, 31.487506],
    [104.482311, 31.485136],
    [104.474104, 31.489711],
    [104.480214, 31.502213],
    [104.480472, 31.50552],
    [104.486503, 31.501884],
    [104.493938, 31.505895],
    [104.501334, 31.505051],
    [104.510964, 31.495669],
    [104.509659, 31.491001],
    [104.512487, 31.486708],
    [104.524312, 31.483612],
    [104.529118, 31.477958],
    [104.535841, 31.475752],
    [104.543652, 31.476245],
    [104.553322, 31.48279],
    [104.561904, 31.48082],
    [104.577447, 31.471787],
    [104.58166, 31.472139],
    [104.586465, 31.477606],
    [104.591982, 31.487693],
    [104.603629, 31.500899],
    [104.616345, 31.507936],
    [104.629515, 31.510703],
    [104.633153, 31.518301],
    [104.637741, 31.520107],
    [104.635131, 31.527048],
    [104.637346, 31.533051],
    [104.637484, 31.540037],
    [104.631156, 31.539076],
    [104.625441, 31.54067],
    [104.625837, 31.54632],
    [104.618579, 31.552931],
    [104.616938, 31.561276],
    [104.606971, 31.563292],
    [104.595008, 31.558487],
    [104.591725, 31.558862],
    [104.591112, 31.563691],
    [104.597697, 31.564534],
    [104.599892, 31.567581],
    [104.595443, 31.570488],
    [104.596451, 31.578948],
    [104.603135, 31.577308],
    [104.601513, 31.5808],
    [104.608613, 31.580261],
    [104.60537, 31.584432],
    [104.602977, 31.591649],
    [104.613695, 31.598187],
    [104.608909, 31.607183],
    [104.599378, 31.610815],
    [104.592892, 31.611494],
    [104.57901, 31.618381],
    [104.578001, 31.62316],
    [104.569102, 31.622645],
    [104.567046, 31.620185],
    [104.558009, 31.616648],
    [104.555141, 31.619693],
    [104.545946, 31.621825],
    [104.548635, 31.626065],
    [104.541002, 31.62754],
    [104.543178, 31.633607],
    [104.550712, 31.636979],
    [104.553144, 31.643022],
    [104.549249, 31.648829],
    [104.544522, 31.65082],
    [104.540468, 31.65562],
    [104.532044, 31.659016],
    [104.523225, 31.66522],
    [104.514504, 31.676388],
    [104.509145, 31.669201],
    [104.50608, 31.670933],
    [104.506634, 31.664424],
    [104.509343, 31.656908],
    [104.50436, 31.648478],
    [104.504063, 31.644099],
    [104.508255, 31.637729],
    [104.51395, 31.635972],
    [104.514722, 31.632248],
    [104.506752, 31.620818],
    [104.498823, 31.618826],
    [104.487215, 31.605497],
    [104.46835, 31.592165],
    [104.46127, 31.588322],
    [104.454191, 31.588556],
    [104.450394, 31.591274],
    [104.44373, 31.589751],
    [104.447665, 31.587408],
    [104.452925, 31.573839],
    [104.445964, 31.567136],
    [104.438806, 31.565214],
    [104.432438, 31.567769],
    [104.432913, 31.571355],
    [104.427574, 31.571402],
    [104.421404, 31.568683],
    [104.420435, 31.565284],
    [104.413336, 31.558862],
    [104.40766, 31.557924],
    [104.40422, 31.564722],
    [104.406158, 31.567042],
    [104.402519, 31.576183],
    [104.404576, 31.578151],
    [104.400878, 31.583073],
    [104.404595, 31.583284],
    [104.407384, 31.590243],
    [104.403468, 31.592868],
    [104.394906, 31.592938],
    [104.396765, 31.598233],
    [104.392968, 31.600202],
    [104.396646, 31.60634],
    [104.394747, 31.608542],
    [104.398445, 31.613275],
    [104.393284, 31.610323],
    [104.391485, 31.615055],
    [104.383693, 31.617257],
    [104.380648, 31.621169],
    [104.372521, 31.615242],
    [104.373845, 31.619178],
    [104.364116, 31.62822],
    [104.369989, 31.637541],
    [104.365599, 31.640703],
    [104.36556, 31.645176],
    [104.359825, 31.650305],
    [104.353893, 31.651171],
    [104.358144, 31.654988],
    [104.355059, 31.656112],
    [104.364986, 31.664565],
    [104.373667, 31.664143],
    [104.3726, 31.668615],
    [104.376416, 31.667819],
    [104.381301, 31.67098],
    [104.381874, 31.679197],
    [104.386719, 31.684394],
    [104.383159, 31.686992],
    [104.377504, 31.684652],
    [104.375111, 31.687882],
    [104.377484, 31.694389],
    [104.374281, 31.704617],
    [104.371215, 31.707285],
    [104.359983, 31.705623],
    [104.341177, 31.713674],
    [104.345824, 31.720881],
    [104.349147, 31.732604],
    [104.346556, 31.738406],
    [104.337796, 31.735107],
    [104.332971, 31.736207],
    [104.324112, 31.748114],
    [104.318911, 31.747389],
    [104.306611, 31.757518],
    [104.307046, 31.766101],
    [104.305167, 31.775129],
    [104.300975, 31.786961],
    [104.297257, 31.789697],
    [104.287489, 31.786821],
    [104.281279, 31.78163],
  ];
  const lineStyle = {
    // clampToGround: true, // 线条贴地
    // arcType: Cesium.ArcType.GEODESIC, // 测地线（沿地球表面）
    // arcType: Cesium.ArcType.RHUMB, // 恒向线
    granularity: 1000, // 线条的平滑度
  };
  const polyline = viewer.entities.add({
    polyline: {
      ...lineStyle,
      positions: positions.map((pos) =>
        Cesium.Cartesian3.fromDegrees(pos[0], pos[1])
      ), // 将经纬度转换为笛卡尔坐标
      width: 10,
      material: new Cesium.PolylineDashMaterialProperty({
        color: Cesium.Color.AQUA,
        dashLength: 100,
        // dashPattern: parseInt("11110000", 2),
      }),
    },
  });
  const solidLine = viewer.entities.add({
    polyline: {
      ...lineStyle,
      positions: positions.map((pos) =>
        Cesium.Cartesian3.fromDegrees(pos[0], pos[1])
      ), // 将经纬度转换为笛卡尔坐标
      width: 4,
      material: Cesium.Color.AQUA,
    },
  });
  viewer.zoomTo([solidLine]); // 缩放到线的位置
  // 设置相机位置
  // viewer.camera.flyTo({
  //   destination: Cesium.Cartesian3.fromDegrees(116.42, 39.93, 5000), // 设置相机位置
  //   duration: 2, // 飞行时间
  // });

  // -------------------------------

  const tiandituProvider = new Cesium.WebMapTileServiceImageryProvider({
    url:
      "http://{s}.tianditu.gov.cn/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=" +
      "05be06461004055923091de7f3e51aa6",
    layer: "img",
    style: "default",
    format: "tiles",
    tileMatrixSetID: "w", // 天地图使用 Web 墨卡托投影（EPSG:3857），需确保 tileMatrixSetID: "w"
    subdomains: ["t0", "t1", "t2", "t3", "t4", "t5", "t6", "t7"], // 子域名
    maximumLevel: 18,
    credit: new Cesium.Credit("天地图影像"),
  });
  // 将天地图影像添加到viewer实例的影像图层集合中
  // const layer = viewer.imageryLayers.addImageryProvider(tiandituProvider);
  // layer.alpha = 0.9; // 设置透明度
  // 清空logo
  viewer.cesiumWidget.creditContainer.style.display = "none";
});
</script>
